# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-rest-api-specs/main/documentation/api-scenario/references/v1.2/schema.json
scope: ResourceGroup

variables:
  labName:
    type: string
    prefix: labna
  adminPassword:
    type: string
  # virtualMachineName: 0

prepareSteps:
      - operationId: Labs_CreateOrUpdate
        # exampleFile: ..\examples\Labs\putLab.json
        parameters:
          body:
            location: $(location)
            properties: 
              title: Test Lab
              description: This is a test lab.
              connectionProfile: 
                webSshAccess: None
                webRdpAccess: None
                clientSshAccess: Public
                clientRdpAccess: Public
              autoShutdownProfile:
                shutdownOnDisconnect: Enabled
                shutdownWhenNotConnected: Enabled
                shutdownOnIdle: UserAbsence
                disconnectDelay: PT15M
                noConnectDelay: PT15M
                idleDelay: PT15M
              securityProfile: 
                openAccess: Disabled
              virtualMachineProfile:
                createOption: TemplateVM
                sku: 
                  name: Standard_Fsv2_2_4GB_64_S_SSD
                  capacity: 0
                additionalCapabilities: 
                  installGpuDrivers: Disabled
                usageQuota: 2
                useSharedPassword: Disabled
                adminUser:
                  username: test-user
                  password: $(adminPassword)
                imageReference:
                  offer: 0001-com-ubuntu-server-focal
                  publisher: canonical
                  sku: 20_04-lts
                  version: latest

# pass
scenarios:
  - scenario: VirtualMachines
    description: Microsoft.LabServices/labs/{labName}/virtualMachines/{virtualMachineName}
    steps:
      - operationId: VirtualMachines_ListByLab
        exampleFile: ..\examples\VirtualMachines\listVirtualMachine.json
        outputVariables:
          virtualMachineName:
            type: string
            fromResponse: /value/name
      - operationId: VirtualMachines_Get
        exampleFile: ..\examples\VirtualMachines\getVirtualMachine.json
      - operationId: VirtualMachines_Start
        exampleFile: ..\examples\VirtualMachines\startVirtualMachine.json
      - operationId: VirtualMachines_Redeploy
        exampleFile: ..\examples\VirtualMachines\redeployVirtualMachine.json
      - operationId: VirtualMachines_Reimage
        exampleFile: ..\examples\VirtualMachines\reimageVirtualMachine.json
      - operationId: VirtualMachines_ResetPassword
        exampleFile: ..\examples\VirtualMachines\resetPasswordVirtualMachine.json
        requestUpdate:
          - replace: /body/username
            value: test-user
          - replace: /body/password
            value: $(adminPassword)
      - operationId: VirtualMachines_Stop
        exampleFile: ..\examples\VirtualMachines\stopVirtualMachine.json
