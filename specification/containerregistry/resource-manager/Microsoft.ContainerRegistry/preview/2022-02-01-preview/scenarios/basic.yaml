# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-rest-api-specs/main/documentation/api-scenario/references/v1.2/schema.json
scope: ResourceGroup

variables:
  registryName:
    type: string
    prefix: registryna
  webhookName:
    type: string
    prefix: webhooknam
  replicationName:
    type: string
    prefix: replicatio
  scopeMapName:
    type: string
    prefix: scopemapna
  tokenName:
    type: string
    prefix: tokenname
  exportPipelineName:
    type: string
    prefix: exportpipe
  importPipelineName:
    type: string
    prefix: importpipe

scenarios:
  - scenario: ContainerRegister
    description: Microsoft.ContainerRegistry/registries
    steps:
      # Registry
      - step: Registries_CheckNameAvailability
        exampleFile: ..\examples\RegistryCheckNameAvailable.json
      - step: Registries_Create
        exampleFile: ..\examples\RegistryCreate.json
        requestUpdate:
          - replace: /registry/sku/name
            value: Premium
      - step: Registries_List
        exampleFile: ..\examples\RegistryList.json
      - step: Registries_Get
        exampleFile: ..\examples\RegistryGet.json
      - step: Registries_ListByResourceGroup
        exampleFile: ..\examples\RegistryListByResourceGroup.json
      - step: Registries_ListUsages
        exampleFile: ..\examples\RegistryListUsages.json
      - step: Registries_Update
        exampleFile: ..\examples\RegistryUpdate.json
        requestUpdate:
          - replace: /registryUpdateParameters/sku/name
            value: Premium
        
      # Webhook
      - step: Webhooks_Create
        exampleFile: ..\examples\WebhookCreate.json
        requestUpdate:
          - remove: /webhookCreateParameters/properties/scope
      - step: Webhooks_List
        exampleFile: ..\examples\WebhookList.json
      - step: Webhooks_Get
        exampleFile: ..\examples\WebhookGet.json
      - step: Webhooks_Update
        exampleFile: ..\examples\WebhookUpdate.json
        requestUpdate:
          - replace: /webhookUpdateParameters/properties/scope
            value: repository
      - step: Webhooks_GetCallbackConfig
        exampleFile: ..\examples\WebhookGetCallbackConfig.json
      - step: Webhooks_Ping
        exampleFile: ..\examples\WebhookPing.json
      - step: Webhooks_ListEvents
        exampleFile: ..\examples\WebhookListEvents.json

      # Replication
      - step: Replications_Create
        exampleFile: ..\examples\ReplicationCreate.json
        requestUpdate:
          - replace: /replication/location
            value: westus2 # use other location
      - step: Replications_List
        exampleFile: ..\examples\ReplicationList.json
      - step: Replications_Get
        exampleFile: ..\examples\ReplicationGet.json
      - step: Replications_Update
        exampleFile: ..\examples\ReplicationUpdate.json

      # # ScopeMaps
      - step: ScopeMaps_Create
        exampleFile: ..\examples\ScopeMapCreate.json
        requestUpdate:
          - replace: /scopeMapCreateParameters/properties/actions
            value: [
              "repositories/myrepository/content/write",
              "repositories/myrepository/content/delete"
            ]
        outputVariables:
          scopeMapId:
            type: string
            fromResponse: /id
      - step: ScopeMaps_List
        exampleFile: ..\examples\ScopeMapList.json
      - step: ScopeMaps_Get
        exampleFile: ..\examples\ScopeMapGet.json
      - step: ScopeMaps_Update
        exampleFile: ..\examples\ScopeMapUpdate.json
        requestUpdate:
          - replace: /scopeMapUpdateParameters/properties/actions
            value: [
              "repositories/myrepository/content/write",
              "repositories/myrepository/content/read"
            ]

      # Token
      - step: Tokens_Create
        exampleFile: ..\examples\TokenCreate.json
        requestUpdate:
          - remove: /tokenCreateParameters/properties/credentials
          - replace: /tokenCreateParameters/properties/scopeMapId
            value: $(scopeMapId)
        outputVariables:
          tokenId:
            type: string
            fromResponse: /id
      - step: Tokens_List
        exampleFile: ..\examples\TokenList.json
      - step: Tokens_Get
        exampleFile: ..\examples\TokenGet.json
      - step: Tokens_Update
        exampleFile: ..\examples\TokenUpdate.json
        requestUpdate:
          - remove: /tokenUpdateParameters/properties/credentials
          - replace: /tokenUpdateParameters/properties/scopeMapId
            value: $(scopeMapId)
      
      # Credentials
      - step: Registries_GenerateCredentials
        exampleFile: ..\examples\RegistryGenerateCredentials.json
        requestUpdate:
          - remove: /generateCredentialsParameters/expiry
          - replace: /generateCredentialsParameters/tokenId
            value: $(tokenId)
      - step: Registries_RegenerateCredential
        exampleFile: ..\examples\RegistryRegenerateCredential.json
      - step: Registries_ListCredentials
        exampleFile: ..\examples\RegistryListCredentials.json

      # ExportPipeline
      - step: ExportPipelines_Create
        exampleFile: ..\examples\ExportPipelineCreate.json
      - step: ExportPipelines_List
        exampleFile: ..\examples\ExportPipelineList.json
      - step: ExportPipelines_Get
        exampleFile: ..\examples\ExportPipelineGet.json

      # ImportPipeline
      - step: ImportPipelines_Create
        exampleFile: ..\examples\ImportPipelineCreate.json
        requestUpdate:
          - remove: /importPipelineCreateParameters/identity/userAssignedIdentities
          - replace: /importPipelineCreateParameters/identity/type
            value: SystemAssigned
      - step: ImportPipelines_List
        exampleFile: ..\examples\ImportPipelineList.json
      - step: ImportPipelines_Get
        exampleFile: ..\examples\ImportPipelineGet.json

      - step: Operations_List
        exampleFile: ..\examples\OperationList.json
      - step: Registries_ListPrivateLinkResources
        exampleFile: ..\examples\RegistryListPrivateLinkResources.json
      - step: Registries_GetPrivateLinkResource
        exampleFile: ..\examples\RegistryGetPrivateLinkResource.json
        requestUpdate:
          - replace: /groupName
            value: registry
      
      # Delete Resource
      - step: ImportPipelines_Delete
        exampleFile: ..\examples\ImportPipelineDelete.json
      - step: ExportPipelines_Delete
        exampleFile: ..\examples\ExportPipelineDelete.json
      - step: Tokens_Delete
        exampleFile: ..\examples\TokenDelete.json
      - step: ScopeMaps_Delete
        exampleFile: ..\examples\ScopeMapDelete.json
      - step: Replications_Delete
        exampleFile: ..\examples\ReplicationDelete.json
      - step: Webhooks_Delete
        exampleFile: ..\examples\WebhookDelete.json
      - step: Registries_Delete
        exampleFile: ..\examples\RegistryDelete.json
