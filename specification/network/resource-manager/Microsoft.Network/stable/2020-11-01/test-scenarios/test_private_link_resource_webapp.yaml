scope: ResourceGroup
testScenarios:
  - description: test_private_link_resource_webapp
    steps:
      - step: RawStep_3425
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: appservice plan create
          Connection: keep-alive
          ParameterSetName: '-g -n --sku'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001","name":"clitest.rg000001","type":"Microsoft.Resources/resourceGroups","location":"westus2","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T07:18:47Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: RawStep_3426
        method: POST
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/validate?api-version=2019-08-01
        requestBody: >-
          {"name":"webapp-privatelink-asp000002","type":"Microsoft.Web/serverfarms","location":"westus2","properties":{"skuName":"P1V2","capacity":1}}
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: appservice plan create
          Connection: keep-alive
          Content-Length: '162'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '-g -n --sku'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-web/0.48.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: '{"status":"Success","error":null}'
      - step: RawStep_3427
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: appservice plan create
          Connection: keep-alive
          ParameterSetName: '-g -n --sku'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001","name":"clitest.rg000001","type":"Microsoft.Resources/resourceGroups","location":"westus2","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T07:18:47Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: RawStep_3428
        method: PUT
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/serverfarms/webapp-privatelink-asp000002?api-version=2019-08-01
        requestBody: >-
          {"location":"westus2","properties":{"perSiteScaling":false,"isXenon":false},"sku":{"name":"P1V2","tier":"PREMIUMV2","capacity":1}}
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: appservice plan create
          Connection: keep-alive
          Content-Length: '143'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '-g -n --sku'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-web/0.48.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/serverfarms/webapp-privatelink-asp000002","name":"webapp-privatelink-asp000002","type":"Microsoft.Web/serverfarms","kind":"app","location":"westus2","properties":{"serverFarmId":4086,"name":"webapp-privatelink-asp000002","sku":{"name":"P1v2","tier":"PremiumV2","size":"P1v2","family":"Pv2","capacity":1},"workerSize":"D1","workerSizeId":3,"workerTierName":null,"numberOfWorkers":1,"currentWorkerSize":"D1","currentWorkerSizeId":3,"currentNumberOfWorkers":1,"status":"Ready","webSpace":"clitest.rg000001-WestUS2webspace","subscription":"0b1f6471-1bf0-4dda-aec3-cb9272f09590","adminSiteName":null,"hostingEnvironment":null,"hostingEnvironmentProfile":null,"maximumNumberOfWorkers":0,"planName":"VirtualDedicatedPlan","adminRuntimeSiteName":null,"computeMode":"Dedicated","siteMode":null,"geoRegion":"West
          US
          2","perSiteScaling":false,"maximumElasticWorkerCount":1,"numberOfSites":0,"hostingEnvironmentId":null,"isSpot":false,"spotExpirationTime":null,"freeOfferExpirationTime":null,"tags":null,"kind":"app","resourceGroup":"clitest.rg000001","reserved":false,"isXenon":false,"hyperV":false,"mdmId":"waws-prod-mwh-067_4086","targetWorkerCount":0,"targetWorkerSizeId":0,"provisioningState":"Succeeded","webSiteId":null,"existingServerFarmIds":null,"azBalancing":false},"sku":{"name":"P1v2","tier":"PremiumV2","size":"P1v2","family":"Pv2","capacity":1}}
      - step: RawStep_3429
        method: POST
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/validate?api-version=2019-08-01
        requestBody: >-
          {"name":"webapp-privatelink-webapp000003","type":"Microsoft.Web/sites","location":"West
          US
          2","properties":{"serverFarmId":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/serverfarms/webapp-privatelink-asp000002"}}
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: webapp create
          Connection: keep-alive
          Content-Length: '363'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '-g -n --plan'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-web/0.48.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: '{"status":"Success","error":null}'
      - step: RawStep_3430
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/serverfarms/webapp-privatelink-asp000002?api-version=2019-08-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: webapp create
          Connection: keep-alive
          ParameterSetName: '-g -n --plan'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-web/0.48.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/serverfarms/webapp-privatelink-asp000002","name":"webapp-privatelink-asp000002","type":"Microsoft.Web/serverfarms","kind":"app","location":"West
          US
          2","properties":{"serverFarmId":4086,"name":"webapp-privatelink-asp000002","workerSize":"D1","workerSizeId":3,"workerTierName":null,"numberOfWorkers":1,"currentWorkerSize":"D1","currentWorkerSizeId":3,"currentNumberOfWorkers":1,"status":"Ready","webSpace":"clitest.rg000001-WestUS2webspace","subscription":"0b1f6471-1bf0-4dda-aec3-cb9272f09590","adminSiteName":null,"hostingEnvironment":null,"hostingEnvironmentProfile":null,"maximumNumberOfWorkers":30,"planName":"VirtualDedicatedPlan","adminRuntimeSiteName":null,"computeMode":"Dedicated","siteMode":null,"geoRegion":"West
          US
          2","perSiteScaling":false,"maximumElasticWorkerCount":1,"numberOfSites":0,"hostingEnvironmentId":null,"isSpot":false,"spotExpirationTime":null,"freeOfferExpirationTime":null,"tags":null,"kind":"app","resourceGroup":"clitest.rg000001","reserved":false,"isXenon":false,"hyperV":false,"mdmId":"waws-prod-mwh-067_4086","targetWorkerCount":0,"targetWorkerSizeId":0,"provisioningState":"Succeeded","webSiteId":null,"existingServerFarmIds":null,"azBalancing":false},"sku":{"name":"P1v2","tier":"PremiumV2","size":"P1v2","family":"Pv2","capacity":1}}
      - step: RawStep_3431
        method: POST
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Web/checknameavailability?api-version=2019-08-01
        requestBody: '{"name":"webapp-privatelink-webapp000003","type":"Site"}'
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: webapp create
          Connection: keep-alive
          Content-Length: '68'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '-g -n --plan'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-web/0.48.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: '{"nameAvailable":true,"reason":"","message":""}'
      - step: RawStep_3432
        method: PUT
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/sites/webapp-privatelink-webapp000003?api-version=2019-08-01
        requestBody: >-
          {"location":"West US
          2","properties":{"serverFarmId":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/serverfarms/webapp-privatelink-asp000002","reserved":false,"isXenon":false,"hyperV":false,"siteConfig":{"netFrameworkVersion":"v4.6","appSettings":[{"name":"WEBSITE_NODE_DEFAULT_VERSION","value":"10.14.1"}],"alwaysOn":true,"localMySqlEnabled":false,"http20Enabled":true},"scmSiteAlsoStopped":false,"httpsOnly":false}}
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: webapp create
          Connection: keep-alive
          Content-Length: '578'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '-g -n --plan'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-web/0.48.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/sites/webapp-privatelink-webapp000003","name":"webapp-privatelink-webapp000003","type":"Microsoft.Web/sites","kind":"app","location":"West
          US
          2","properties":{"name":"webapp-privatelink-webapp000003","state":"Running","hostNames":["webapp-privatelink-webapp000003.azurewebsites.net"],"webSpace":"clitest.rg000001-WestUS2webspace","selfLink":"https://waws-prod-mwh-067.api.azurewebsites.windows.net:454/subscriptions/00000000-0000-0000-0000-000000000000/webspaces/clitest.rg000001-WestUS2webspace/sites/webapp-privatelink-webapp000003","repositorySiteName":"webapp-privatelink-webapp000003","owner":null,"usageState":"Normal","enabled":true,"adminEnabled":true,"enabledHostNames":["webapp-privatelink-webapp000003.azurewebsites.net","webapp-privatelink-webapp000003.scm.azurewebsites.net"],"siteProperties":{"metadata":null,"properties":[{"name":"LinuxFxVersion","value":""},{"name":"WindowsFxVersion","value":null}],"appSettings":null},"availabilityState":"Normal","sslCertificates":null,"csrs":[],"cers":null,"siteMode":null,"hostNameSslStates":[{"name":"webapp-privatelink-webapp000003.azurewebsites.net","sslState":"Disabled","ipBasedSslResult":null,"virtualIP":null,"thumbprint":null,"toUpdate":null,"toUpdateIpBasedSsl":null,"ipBasedSslState":"NotConfigured","hostType":"Standard"},{"name":"webapp-privatelink-webapp000003.scm.azurewebsites.net","sslState":"Disabled","ipBasedSslResult":null,"virtualIP":null,"thumbprint":null,"toUpdate":null,"toUpdateIpBasedSsl":null,"ipBasedSslState":"NotConfigured","hostType":"Repository"}],"computeMode":null,"serverFarm":null,"serverFarmId":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/serverfarms/webapp-privatelink-asp000002","reserved":false,"isXenon":false,"hyperV":false,"lastModifiedTimeUtc":"2021-03-04T07:19:13.6466667","storageRecoveryDefaultState":"Running","contentAvailabilityState":"Normal","runtimeAvailabilityState":"Normal","siteConfig":{"numberOfWorkers":null,"defaultDocuments":null,"netFrameworkVersion":null,"phpVersion":null,"pythonVersion":null,"nodeVersion":null,"powerShellVersion":null,"linuxFxVersion":null,"windowsFxVersion":null,"requestTracingEnabled":null,"remoteDebuggingEnabled":null,"remoteDebuggingVersion":null,"httpLoggingEnabled":null,"azureMonitorLogCategories":null,"acrUseManagedIdentityCreds":false,"acrUserManagedIdentityID":null,"logsDirectorySizeLimit":null,"detailedErrorLoggingEnabled":null,"publishingUsername":null,"publishingPassword":null,"appSettings":null,"azureStorageAccounts":null,"metadata":null,"connectionStrings":null,"machineKey":null,"handlerMappings":null,"documentRoot":null,"scmType":null,"use32BitWorkerProcess":null,"webSocketsEnabled":null,"alwaysOn":null,"javaVersion":null,"javaContainer":null,"javaContainerVersion":null,"appCommandLine":null,"managedPipelineMode":null,"virtualApplications":null,"winAuthAdminState":null,"winAuthTenantState":null,"customAppPoolIdentityAdminState":null,"customAppPoolIdentityTenantState":null,"runtimeADUser":null,"runtimeADUserPassword":null,"loadBalancing":null,"routingRules":null,"experiments":null,"limits":null,"autoHealEnabled":null,"autoHealRules":null,"tracingOptions":null,"vnetName":null,"vnetRouteAllEnabled":null,"vnetPrivatePortsCount":null,"cors":null,"push":null,"apiDefinition":null,"apiManagementConfig":null,"autoSwapSlotName":null,"localMySqlEnabled":null,"managedServiceIdentityId":null,"xManagedServiceIdentityId":null,"ipSecurityRestrictions":[{"ipAddress":"Any","action":"Allow","priority":1,"name":"Allow
          all","description":"Allow all
          access"}],"scmIpSecurityRestrictions":[{"ipAddress":"Any","action":"Allow","priority":1,"name":"Allow
          all","description":"Allow all
          access"}],"scmIpSecurityRestrictionsUseMain":null,"http20Enabled":null,"minTlsVersion":null,"scmMinTlsVersion":null,"ftpsState":null,"preWarmedInstanceCount":null,"functionAppScaleLimit":null,"healthCheckPath":null,"fileChangeAuditEnabled":null,"functionsRuntimeScaleMonitoringEnabled":null,"websiteTimeZone":null,"minimumElasticInstanceCount":0},"deploymentId":"webapp-privatelink-webapp000003","trafficManagerHostNames":null,"sku":"PremiumV2","scmSiteAlsoStopped":false,"targetSwapSlot":null,"hostingEnvironment":null,"hostingEnvironmentProfile":null,"clientAffinityEnabled":true,"clientCertEnabled":false,"clientCertMode":"Required","clientCertExclusionPaths":null,"hostNamesDisabled":false,"domainVerificationIdentifiers":null,"customDomainVerificationId":"253001F2FCF5A7B1CD759EB861E9BB1596370BE27E47A991F72184277B3D12F2","kind":"app","inboundIpAddress":"40.64.128.229","possibleInboundIpAddresses":"40.64.128.229","ftpUsername":"webapp-privatelink-webapp000003\\$webapp-privatelink-webapp000003","ftpsHostName":"ftps://waws-prod-mwh-067.ftp.azurewebsites.windows.net/site/wwwroot","outboundIpAddresses":"51.143.116.2,51.143.116.179,51.143.117.17,51.143.117.157,51.143.50.47,51.143.50.82,40.64.128.229","possibleOutboundIpAddresses":"40.91.72.101,40.91.83.59,40.91.86.77,51.143.114.125,51.143.115.27,51.143.115.236,51.143.116.2,51.143.116.179,51.143.117.17,51.143.117.157,51.143.50.47,51.143.50.82,40.91.73.128,51.143.52.81,51.143.52.123,51.143.53.139,51.143.53.247,51.143.54.101,51.143.54.216,51.143.55.124,51.143.55.189,52.137.104.238,52.137.106.41,52.137.107.0,52.137.109.218,52.137.110.165,52.137.110.171,52.137.111.199,52.137.96.52,52.137.96.196,40.64.128.229","containerSize":0,"dailyMemoryTimeQuota":0,"suspendedTill":null,"siteDisabledReason":0,"functionExecutionUnitsCache":null,"maxNumberOfWorkers":null,"homeStamp":"waws-prod-mwh-067","cloningInfo":null,"hostingEnvironmentId":null,"tags":null,"resourceGroup":"clitest.rg000001","defaultHostName":"webapp-privatelink-webapp000003.azurewebsites.net","slotSwapStatus":null,"httpsOnly":false,"redundancyMode":"None","inProgressOperationId":null,"geoDistributions":null,"privateEndpointConnections":null,"buildVersion":null,"targetBuildVersion":null,"migrationState":null,"eligibleLogCategories":"AppServiceAppLogs,AppServiceAuditLogs,AppServiceConsoleLogs,AppServiceHTTPLogs,AppServiceIPSecAuditLogs,AppServicePlatformLogs,ScanLogs,AppServiceFileAuditLogs,AppServiceAntivirusScanAuditLogs","storageAccountRequired":false}}
      - step: RawStep_3433
        method: POST
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/sites/webapp-privatelink-webapp000003/publishxml?api-version=2019-08-01
        requestBody: '{}'
        requestHeaders:
          Accept: application/xml
          Accept-Encoding: gzip, deflate
          CommandName: webapp create
          Connection: keep-alive
          Content-Length: '2'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '-g -n --plan'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-web/0.48.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          <publishData><publishProfile
          profileName="webapp-privatelink-webapp000003 - Web Deploy"
          publishMethod="MSDeploy"
          publishUrl="webapp-privatelink-webapp000003.scm.azurewebsites.net:443"
          msdeploySite="webapp-privatelink-webapp000003"
          userName="$webapp-privatelink-webapp000003"
          userPWD="EQFX1rt9Qb7icKsiBcSzqG7ezQjhxrsL0tvsCn6kmJdlSEkwfqHvxTh7p9RK"
          destinationAppUrl="http://webapp-privatelink-webapp000003.azurewebsites.net"
          SQLServerDBConnectionString="" mySQLDBConnectionString=""
          hostingProviderForumLink=""
          controlPanelLink="http://windows.azure.com"
          webSystem="WebSites"><databases /></publishProfile><publishProfile
          profileName="webapp-privatelink-webapp000003 - FTP"
          publishMethod="FTP"
          publishUrl="ftp://waws-prod-mwh-067.ftp.azurewebsites.windows.net/site/wwwroot"
          ftpPassiveMode="True"
          userName="webapp-privatelink-webapp000003\$webapp-privatelink-webapp000003"
          userPWD="EQFX1rt9Qb7icKsiBcSzqG7ezQjhxrsL0tvsCn6kmJdlSEkwfqHvxTh7p9RK"
          destinationAppUrl="http://webapp-privatelink-webapp000003.azurewebsites.net"
          SQLServerDBConnectionString="" mySQLDBConnectionString=""
          hostingProviderForumLink=""
          controlPanelLink="http://windows.azure.com"
          webSystem="WebSites"><databases /></publishProfile><publishProfile
          profileName="webapp-privatelink-webapp000003 - Zip Deploy"
          publishMethod="ZipDeploy"
          publishUrl="webapp-privatelink-webapp000003.scm.azurewebsites.net:443"
          userName="$webapp-privatelink-webapp000003"
          userPWD="EQFX1rt9Qb7icKsiBcSzqG7ezQjhxrsL0tvsCn6kmJdlSEkwfqHvxTh7p9RK"
          destinationAppUrl="http://webapp-privatelink-webapp000003.azurewebsites.net"
          SQLServerDBConnectionString="" mySQLDBConnectionString=""
          hostingProviderForumLink=""
          controlPanelLink="http://windows.azure.com"
          webSystem="WebSites"><databases /></publishProfile></publishData>
      - step: RawStep_3434
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/sites/webapp-privatelink-webapp000003/privateLinkResources?api-version=2019-08-01
        requestHeaders:
          Accept: '*/*'
          Accept-Encoding: gzip, deflate
          CommandName: network private-link-resource list
          Connection: keep-alive
          ParameterSetName: '--id'
          User-Agent: python/3.7.3 (Windows-10-10.0.19041-SP0) AZURECLI/2.20.0
        responseExpected: >-
          {"value":[{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Web/sites/webapp-privatelink-webapp000003/privateLinkResources/sites","name":"sites","type":"Microsoft.Web/sites/privateLinkResources","properties":{"groupId":"sites","requiredMembers":["sites"],"requiredZoneNames":["privatelink.azurewebsites.net"]}}]}
