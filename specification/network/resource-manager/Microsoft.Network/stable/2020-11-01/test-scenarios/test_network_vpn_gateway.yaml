scope: ResourceGroup
testScenarios:
  - description: test_network_vpn_gateway
    steps:
      - step: RawStep_2675
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network public-ip create
          Connection: keep-alive
          ParameterSetName: '-n -g'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_publicIPAddresses_pubip1
        resourceName: publicIPAddresses_pubip1
        exampleFile: ../examples/Create_publicIPAddresses_pubip1_Generated_2677.json
        operationId: PublicIPAddresses_CreateOrUpdate
      - step: RawStep_2678
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network public-ip create
          Connection: keep-alive
          ParameterSetName: '-n -g'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_publicIPAddresses_pubip2
        resourceName: publicIPAddresses_pubip2
        exampleFile: ../examples/Create_publicIPAddresses_pubip2_Generated_2680.json
        operationId: PublicIPAddresses_CreateOrUpdate
        variables:
          publicIpAddressName: pubip2
      - step: RawStep_2681
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network public-ip create
          Connection: keep-alive
          ParameterSetName: '-n -g'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_publicIPAddresses_pubip3
        resourceName: publicIPAddresses_pubip3
        exampleFile: ../examples/Create_publicIPAddresses_pubip3_Generated_2683.json
        operationId: PublicIPAddresses_CreateOrUpdate
        variables:
          publicIpAddressName: pubip3
      - step: RawStep_2684
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vnet create
          Connection: keep-alive
          ParameterSetName: '-g -n --subnet-name --address-prefix --subnet-prefix'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_virtualNetworks_myvnet1
        resourceName: virtualNetworks_myvnet1
        exampleFile: ../examples/Create_virtualNetworks_myvnet1_Generated.json
        operationId: VirtualNetworks_CreateOrUpdate
      - step: RawStep_2686
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vnet create
          Connection: keep-alive
          ParameterSetName: '-g -n --subnet-name --address-prefix'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_virtualNetworks_myvnet2
        resourceName: virtualNetworks_myvnet2
        exampleFile: ../examples/Create_virtualNetworks_myvnet2_Generated.json
        operationId: VirtualNetworks_CreateOrUpdate
        variables:
          virtualNetworkName: myvnet2
      - step: RawStep_2688
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vnet create
          Connection: keep-alive
          ParameterSetName: '-g -n --subnet-name --address-prefix'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_virtualNetworks_myvnet3
        resourceName: virtualNetworks_myvnet3
        exampleFile: ../examples/Create_virtualNetworks_myvnet3_Generated.json
        operationId: VirtualNetworks_CreateOrUpdate
        variables:
          virtualNetworkName: myvnet3
      - step: RawStep_2690
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vnet-gateway create
          Connection: keep-alive
          ParameterSetName: >-
            -g -n --vnet --public-ip-address --gateway-type
            --vpn-gateway-generation
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: RawStep_2691
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vnet-gateway create
          Connection: keep-alive
          ParameterSetName: >-
            -g -n --vnet --public-ip-address --vpn-gateway-generation
            --custom-routes --no-wait
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_virtualNetworkGateways_gateway1
        resourceName: virtualNetworkGateways_gateway1
        exampleFile: ../examples/Create_virtualNetworkGateways_gateway1_Generated_2693.json
        operationId: VirtualNetworkGateways_CreateOrUpdate
      - step: RawStep_2694
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vnet-gateway create
          Connection: keep-alive
          ParameterSetName: '-g -n --vnet --public-ip-address --no-wait'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_virtualNetworkGateways_gateway2
        resourceName: virtualNetworkGateways_gateway2
        exampleFile: ../examples/Create_virtualNetworkGateways_gateway2_Generated.json
        operationId: VirtualNetworkGateways_CreateOrUpdate
        variables:
          virtualNetworkGatewayName: gateway2
      - step: RawStep_2696
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vnet-gateway create
          Connection: keep-alive
          ParameterSetName: >-
            -g -n --vnet --public-ip-address --no-wait --sku --asn
            --bgp-peering-address --peer-weight
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_virtualNetworkGateways_gateway3
        resourceName: virtualNetworkGateways_gateway3
        exampleFile: ../examples/Create_virtualNetworkGateways_gateway3_Generated.json
        operationId: VirtualNetworkGateways_CreateOrUpdate
        variables:
          virtualNetworkGatewayName: gateway3
      - step: VirtualNetworkGateways_Get_2698
        exampleFile: ../examples/VirtualNetworkGateways_Get_2698_Generated.json
        operationId: VirtualNetworkGateways_Get
      - step: Update_virtualNetworkGateways_gateway1_2702
        resourceName: virtualNetworkGateways_gateway1
        operationId: VirtualNetworkGateways_CreateOrUpdate
        resourceUpdate:
          - replace: /properties/provisioningState
            value: Succeeded
          - replace: /properties/ipConfigurations/0/properties/provisioningState
            value: Succeeded
          - replace: /properties/sku/name
            value: Standard
          - replace: /properties/sku/tier
            value: Standard
          - remove: /properties/vpnClientConfiguration
          - replace: /properties/bgpSettings/asn
            value: 65515
          - add: >-
              /properties/bgpSettings/bgpPeeringAddresses/0/defaultBgpIpAddresses/0
            value: 10.0.0.254
          - add: /properties/bgpSettings/bgpPeeringAddresses/0/tunnelIpAddresses
            value:
              - 40.112.208.116
          - add: /properties/bgpSettings/bgpPeeringAddress
            value: 10.0.0.254
          - add: /properties/customRoutes/addressPrefixes/1
            value: 102.168.0.6/32
      - step: RawStep_2705
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          ParameterSetName: '-n -g --shared-key --vnet-gateway1 --vnet-gateway2 --tags'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: RawStep_2706
        method: PUT
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/mock-deployment?api-version=2020-10-01
        requestBody: >-
          {"properties":{"template":{"$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"sharedKey":{"type":"securestring","metadata":{"description":"Secure
          sharedKey"}}},"variables":{},"resources":[{"type":"Microsoft.Network/connections","name":"conn1to2","location":"westus","tags":{"foo":"doo"},"apiVersion":"2015-06-15","dependsOn":[],"properties":{"virtualNetworkGateway1":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/virtualNetworkGateways/gateway1"},"enableBgp":false,"connectionType":"Vnet2Vnet","routingWeight":10,"usePolicyBasedTrafficSelectors":false,"expressRouteGatewayBypass":null,"virtualNetworkGateway2":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/virtualNetworkGateways/gateway2"},"sharedKey":"[parameters('sharedKey')]"}}],"outputs":{"resource":{"type":"object","value":"[reference('conn1to2')]"}}},"parameters":{"sharedKey":{"value":"123"}},"mode":"Incremental"}}
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          Content-Length: '1280'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '-n -g --shared-key --vnet-gateway1 --vnet-gateway2 --tags'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        statusCode: 201
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/vpn_connection_deploy_qoCVtVlKKAX5WvzXiGv8njYRc5cFHFOO","name":"vpn_connection_deploy_qoCVtVlKKAX5WvzXiGv8njYRc5cFHFOO","type":"Microsoft.Resources/deployments","properties":{"templateHash":"16207537388503300887","parameters":{"sharedKey":{"type":"SecureString"}},"mode":"Incremental","provisioningState":"Accepted","timestamp":"2021-03-04T07:41:34.5986032Z","duration":"PT2.3105359S","correlationId":"d52dcbd5-be7a-45b9-a46d-31c2edb08bfc","providers":[{"namespace":"Microsoft.Network","resourceTypes":[{"resourceType":"connections","locations":["westus"]}]}],"dependencies":[]}}
      - step: RawStep_2707
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/mock-deployment/operationStatuses/08585867631931895476?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          ParameterSetName: '-n -g --shared-key --vnet-gateway1 --vnet-gateway2 --tags'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: '{"status":"Running"}'
      - step: RawStep_2708
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/mock-deployment/operationStatuses/08585867631931895476?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          ParameterSetName: '-n -g --shared-key --vnet-gateway1 --vnet-gateway2 --tags'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: '{"status":"Succeeded"}'
      - step: RawStep_2709
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/mock-deployment?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          ParameterSetName: '-n -g --shared-key --vnet-gateway1 --vnet-gateway2 --tags'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/vpn_connection_deploy_qoCVtVlKKAX5WvzXiGv8njYRc5cFHFOO","name":"vpn_connection_deploy_qoCVtVlKKAX5WvzXiGv8njYRc5cFHFOO","type":"Microsoft.Resources/deployments","properties":{"templateHash":"16207537388503300887","parameters":{"sharedKey":{"type":"SecureString"}},"mode":"Incremental","provisioningState":"Succeeded","timestamp":"2021-03-04T07:42:13.9114385Z","duration":"PT41.6233712S","correlationId":"d52dcbd5-be7a-45b9-a46d-31c2edb08bfc","providers":[{"namespace":"Microsoft.Network","resourceTypes":[{"resourceType":"connections","locations":["westus"]}]}],"dependencies":[],"outputs":{"resource":{"type":"Object","value":{"provisioningState":"Succeeded","resourceGuid":"7fdc73cf-0a02-4686-b0b0-4ec44feb8750","virtualNetworkGateway1":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/virtualNetworkGateways/gateway1"},"virtualNetworkGateway2":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/virtualNetworkGateways/gateway2"},"connectionType":"Vnet2Vnet","connectionProtocol":"IKEv2","routingWeight":10,"sharedKey":"123","enableBgp":false,"useLocalAzureIpAddress":false,"trafficSelectorPolicies":[],"connectionStatus":"NotConnected","ingressBytesTransferred":0,"egressBytesTransferred":0,"dpdTimeoutSeconds":0,"connectionMode":"Default"}}},"outputResources":[{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/connections/conn1to2"}]}}
      - step: VirtualNetworkGatewayConnections_Get_2710
        exampleFile: ../examples/VirtualNetworkGatewayConnections_Get_2710_Generated.json
        operationId: VirtualNetworkGatewayConnections_Get
      - step: VirtualNetworkGateways_Get_2711
        exampleFile: ../examples/VirtualNetworkGateways_Get_2711_Generated.json
        operationId: VirtualNetworkGateways_Get
        variables:
          virtualNetworkGatewayName: gateway2
      - step: Create_connections_conn1to2
        resourceName: connections_conn1to2
        exampleFile: ../examples/Create_connections_conn1to2_Generated.json
        operationId: VirtualNetworkGatewayConnections_CreateOrUpdate
      - step: RawStep_2713
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          ParameterSetName: '-n -g --shared-key --vnet-gateway2 --vnet-gateway1'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001","name":"cli_test_vpn_gateway000001","type":"Microsoft.Resources/resourceGroups","location":"westus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T06:21:10Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: RawStep_2714
        method: PUT
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/mock-deployment?api-version=2020-10-01
        requestBody: >-
          {"properties":{"template":{"$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"sharedKey":{"type":"securestring","metadata":{"description":"Secure
          sharedKey"}}},"variables":{},"resources":[{"type":"Microsoft.Network/connections","name":"conn2to1","location":"westus","tags":{},"apiVersion":"2015-06-15","dependsOn":[],"properties":{"virtualNetworkGateway1":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/virtualNetworkGateways/gateway2"},"enableBgp":false,"connectionType":"Vnet2Vnet","routingWeight":10,"usePolicyBasedTrafficSelectors":false,"expressRouteGatewayBypass":null,"virtualNetworkGateway2":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/virtualNetworkGateways/gateway1"},"sharedKey":"[parameters('sharedKey')]"}}],"outputs":{"resource":{"type":"object","value":"[reference('conn2to1')]"}}},"parameters":{"sharedKey":{"value":"123"}},"mode":"Incremental"}}
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          Content-Length: '1268'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '-n -g --shared-key --vnet-gateway2 --vnet-gateway1'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        statusCode: 201
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/vpn_connection_deploy_UV1K66g4G1z5k8DqaP1dnWUTwCDSjlu3","name":"vpn_connection_deploy_UV1K66g4G1z5k8DqaP1dnWUTwCDSjlu3","type":"Microsoft.Resources/deployments","properties":{"templateHash":"16014867293349290672","parameters":{"sharedKey":{"type":"SecureString"}},"mode":"Incremental","provisioningState":"Accepted","timestamp":"2021-03-04T07:43:52.7214586Z","duration":"PT1.96657S","correlationId":"7bcbdf24-6845-4fd7-b07c-671d5ed92b8b","providers":[{"namespace":"Microsoft.Network","resourceTypes":[{"resourceType":"connections","locations":["westus"]}]}],"dependencies":[]}}
      - step: RawStep_2715
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/mock-deployment/operationStatuses/08585867630547227326?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          ParameterSetName: '-n -g --shared-key --vnet-gateway2 --vnet-gateway1'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: '{"status":"Running"}'
      - step: RawStep_2716
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/mock-deployment/operationStatuses/08585867630547227326?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          ParameterSetName: '-n -g --shared-key --vnet-gateway2 --vnet-gateway1'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: '{"status":"Succeeded"}'
      - step: RawStep_2717
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/mock-deployment?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vpn-connection create
          Connection: keep-alive
          ParameterSetName: '-n -g --shared-key --vnet-gateway2 --vnet-gateway1'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Resources/deployments/vpn_connection_deploy_UV1K66g4G1z5k8DqaP1dnWUTwCDSjlu3","name":"vpn_connection_deploy_UV1K66g4G1z5k8DqaP1dnWUTwCDSjlu3","type":"Microsoft.Resources/deployments","properties":{"templateHash":"16014867293349290672","parameters":{"sharedKey":{"type":"SecureString"}},"mode":"Incremental","provisioningState":"Succeeded","timestamp":"2021-03-04T07:44:31.9421233Z","duration":"PT41.1872347S","correlationId":"7bcbdf24-6845-4fd7-b07c-671d5ed92b8b","providers":[{"namespace":"Microsoft.Network","resourceTypes":[{"resourceType":"connections","locations":["westus"]}]}],"dependencies":[],"outputs":{"resource":{"type":"Object","value":{"provisioningState":"Succeeded","resourceGuid":"c61d1e2f-af16-4759-ad62-ffe108766766","virtualNetworkGateway1":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/virtualNetworkGateways/gateway2"},"virtualNetworkGateway2":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/virtualNetworkGateways/gateway1"},"connectionType":"Vnet2Vnet","connectionProtocol":"IKEv2","routingWeight":10,"sharedKey":"123","enableBgp":false,"useLocalAzureIpAddress":false,"trafficSelectorPolicies":[],"connectionStatus":"Unknown","ingressBytesTransferred":0,"egressBytesTransferred":0,"dpdTimeoutSeconds":0,"connectionMode":"Default"}}},"outputResources":[{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/cli_test_vpn_gateway000001/providers/Microsoft.Network/connections/conn2to1"}]}}
      - step: VirtualNetworkGateways_GetLearnedRoutes_2718
        exampleFile: >-
          ../examples/VirtualNetworkGateways_GetLearnedRoutes_2718_Generated.json
        operationId: VirtualNetworkGateways_GetLearnedRoutes
      - step: VirtualNetworkGateways_GetAdvertisedRoutes_2719
        exampleFile: >-
          ../examples/VirtualNetworkGateways_GetAdvertisedRoutes_2719_Generated.json
        operationId: VirtualNetworkGateways_GetAdvertisedRoutes
      - step: VirtualNetworkGateways_GetBgpPeerStatus_2720
        exampleFile: >-
          ../examples/VirtualNetworkGateways_GetBgpPeerStatus_2720_Generated.json
        operationId: VirtualNetworkGateways_GetBgpPeerStatus
    variables:
      publicIpAddressName: pubip1
      virtualNetworkName: myvnet1
      virtualNetworkGatewayName: gateway1
      virtualNetworkGatewayConnectionName: conn1to2
