scope: ResourceGroup
testScenarios:
  - description: test_private_link_resource_batch_account
    steps:
      - step: RawStep_3392
        method: PUT
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch?api-version=2020-05-01
        requestBody: >-
          {"location":"westcentralus","properties":{"publicNetworkAccess":"Disabled"}}
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: batch account create
          Connection: keep-alive
          Content-Length: '80'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '-g -n -l --public-network-access'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-batch/9.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        statusCode: 202
      - step: RawStep_3393
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network vnet create
          Connection: keep-alive
          ParameterSetName: '-g -n --subnet-name'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001","name":"clitest.rg000001","type":"Microsoft.Resources/resourceGroups","location":"westcentralus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T07:12:59Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_virtualNetworks_testvnet000002
        resourceName: virtualNetworks_testvnet000002
        exampleFile: ../examples/Create_virtualNetworks_testvnet000002_Generated.json
        operationId: VirtualNetworks_CreateOrUpdate
      - step: Subnets_Get_3395
        exampleFile: ../examples/Subnets_Get_4_Generated.json
        operationId: Subnets_Get
      - step: Create_subnets_testsubnet000003
        resourceName: subnets_testsubnet000003
        exampleFile: >-
          ../examples/Create_subnets_appgw_private_endpoint_subnet_Generated.json
        operationId: Subnets_CreateOrUpdate
      - step: RawStep_3397
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/clitest.rg000001?api-version=2020-10-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint create
          Connection: keep-alive
          ParameterSetName: >-
            -n -g --subnet --vnet-name --private-connection-resource-id
            --group-ids --connection-name --manual-request
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-resource/12.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001","name":"clitest.rg000001","type":"Microsoft.Resources/resourceGroups","location":"westcentralus","tags":{"product":"azurecli","cause":"automation","date":"2021-03-04T07:12:59Z"},"properties":{"provisioningState":"Succeeded"}}
      - step: Create_privateEndpoints_priv_endpoint000004
        resourceName: privateEndpoints_priv_endpoint000004
        exampleFile: ../examples/Create_privateEndpoints_priv_endpoint000004_Generated.json
        operationId: PrivateEndpoints_CreateOrUpdate
      - step: RawStep_3399
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections?api-version=2020-05-01
        requestHeaders:
          Accept: '*/*'
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint-connection list
          Connection: keep-alive
          ParameterSetName: '--name --resource-group --type'
          User-Agent: python/3.7.3 (Windows-10-10.0.19041-SP0) AZURECLI/2.20.0
        responseExpected: >-
          {"value":[{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","name":"priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","type":"Microsoft.Batch/batchAccounts/privateEndpointConnections","etag":"W/\"0x8D8DEDD11986F37\"","properties":{"provisioningState":"Succeeded","privateEndpoint":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Network/privateEndpoints/priv_endpoint000004"},"privateLinkServiceConnectionState":{"status":"Pending","description":"Manual
          approval still required","actionsRequired":"Manual approval
          request"}}}]}
      - step: RawStep_3400
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch?api-version=2020-05-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: batch account show
          Connection: keep-alive
          ParameterSetName: '--name --resource-group'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-batch/9.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch","name":"testplinksbatch","type":"Microsoft.Batch/batchAccounts","location":"westcentralus","properties":{"accountEndpoint":"testplinksbatch.westcentralus.batch.azure.com","provisioningState":"Succeeded","dedicatedCoreQuota":700,"dedicatedCoreQuotaPerVMFamily":[{"name":"standardAv2Family","coreQuota":100},{"name":"standardDv2Family","coreQuota":100},{"name":"standardDv3Family","coreQuota":100},{"name":"standardEv3Family","coreQuota":50},{"name":"standardDSv2Family","coreQuota":100},{"name":"standardDSv3Family","coreQuota":100},{"name":"standardESv3Family","coreQuota":50},{"name":"standardFFamily","coreQuota":50},{"name":"standardFSFamily","coreQuota":50},{"name":"standardA0_A7Family","coreQuota":0},{"name":"standardA8_A11Family","coreQuota":0},{"name":"standardDFamily","coreQuota":0},{"name":"standardGFamily","coreQuota":0},{"name":"basicAFamily","coreQuota":0},{"name":"standardNVFamily","coreQuota":0},{"name":"standardNVPromoFamily","coreQuota":0},{"name":"standardNCFamily","coreQuota":0},{"name":"standardNCPromoFamily","coreQuota":0},{"name":"standardHFamily","coreQuota":0},{"name":"standardHPromoFamily","coreQuota":0},{"name":"standardMSFamily","coreQuota":0},{"name":"standardDSFamily","coreQuota":0},{"name":"standardGSFamily","coreQuota":0},{"name":"standardLSFamily","coreQuota":0},{"name":"standardLSv2Family","coreQuota":0},{"name":"standardNCSv2Family","coreQuota":0},{"name":"standardNDSFamily","coreQuota":0},{"name":"standardNCSv3Family","coreQuota":0},{"name":"standardFSv2Family","coreQuota":0},{"name":"standardHBSFamily","coreQuota":0},{"name":"standardHCSFamily","coreQuota":0},{"name":"standardNVSv3Family","coreQuota":0},{"name":"standardHBrsv2Family","coreQuota":0},{"name":"standardDAv4Family","coreQuota":0},{"name":"standardDASv4Family","coreQuota":0},{"name":"standardEAv4Family","coreQuota":0},{"name":"standardEASv4Family","coreQuota":0},{"name":"standardDDv4Family","coreQuota":0},{"name":"standardDDSv4Family","coreQuota":0},{"name":"standardEDv4Family","coreQuota":0},{"name":"standardEDSv4Family","coreQuota":0},{"name":"standardMSv2Family","coreQuota":0},{"name":"standardEIv3Family","coreQuota":0},{"name":"standardNVSv4Family","coreQuota":0},{"name":"Standard
          NCASv3_T4
          Family","coreQuota":0},{"name":"standardXEIDSv4Family","coreQuota":0}],"dedicatedCoreQuotaPerVMFamilyEnforced":true,"lowPriorityCoreQuota":500,"poolQuota":100,"activeJobAndJobScheduleQuota":300,"poolAllocationMode":"BatchService","publicNetworkAccess":"Disabled","privateEndpointConnections":[{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","name":"priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","type":"Microsoft.Batch/batchAccounts/privateEndpointConnections","properties":{"privateEndpoint":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Network/privateEndpoints/priv_endpoint000004"},"provisioningState":"Succeeded","privateLinkServiceConnectionState":{"status":"Pending","description":"Manual
          approval still required","actionsRequired":"Manual approval
          request"}}}],"encryption":{"keySource":"Microsoft.Batch"}},"identity":{"type":"None"}}
      - step: RawStep_3401
        method: PATCH
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc?api-version=2020-05-01
        requestBody: >-
          {"properties":{"privateLinkServiceConnectionState":{"status":"Approved","description":"You
          are approved!"}}}
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint-connection approve
          Connection: keep-alive
          Content-Length: '113'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '--resource-name --name --resource-group --type --description'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-batch/9.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        statusCode: 202
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","name":"priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","type":"Microsoft.Batch/batchAccounts/privateEndpointConnections","etag":"W/\"0x8D8DEDD11986F37\"","properties":{"provisioningState":"Updating","privateEndpoint":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Network/privateEndpoints/priv_endpoint000004"},"privateLinkServiceConnectionState":{"status":"Approved","description":"You
          are approved!","actionsRequired":"Manual approval request"}}}
      - step: RawStep_3402
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnectionResults/Updating$priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc$0022d9f1-2157-42d4-8cd6-860ca1feadf2?api-version=2020-05-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint-connection approve
          Connection: keep-alive
          ParameterSetName: '--resource-name --name --resource-group --type --description'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-batch/9.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: '{"status":"Succeeded","retryAfter":0}'
      - step: RawStep_3403
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc?api-version=2020-05-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint-connection approve
          Connection: keep-alive
          ParameterSetName: '--resource-name --name --resource-group --type --description'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-batch/9.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","name":"priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","type":"Microsoft.Batch/batchAccounts/privateEndpointConnections","etag":"W/\"0x8D8DEDD11986F37\"","properties":{"provisioningState":"Succeeded","privateEndpoint":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Network/privateEndpoints/priv_endpoint000004"},"privateLinkServiceConnectionState":{"status":"Approved","description":"You
          are approved!","actionsRequired":"Manual approval request"}}}
      - step: RawStep_3404
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc?api-version=2020-05-01
        requestHeaders:
          Accept: '*/*'
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint-connection show
          Connection: keep-alive
          ParameterSetName: '--resource-name --name --resource-group --type'
          User-Agent: python/3.7.3 (Windows-10-10.0.19041-SP0) AZURECLI/2.20.0
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","name":"priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","type":"Microsoft.Batch/batchAccounts/privateEndpointConnections","etag":"W/\"0x8D8DEDD11986F37\"","properties":{"provisioningState":"Succeeded","privateEndpoint":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Network/privateEndpoints/priv_endpoint000004"},"privateLinkServiceConnectionState":{"status":"Approved","description":"You
          are approved!","actionsRequired":"Manual approval request"}}}
      - step: RawStep_3405
        method: PATCH
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc?api-version=2020-05-01
        requestBody: >-
          {"properties":{"privateLinkServiceConnectionState":{"status":"Rejected","description":"You
          are rejected!"}}}
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint-connection reject
          Connection: keep-alive
          Content-Length: '113'
          Content-Type: application/json; charset=utf-8
          ParameterSetName: '--resource-name --name --resource-group --type --description'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-batch/9.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
          accept-language: en-US
        statusCode: 202
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","name":"priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","type":"Microsoft.Batch/batchAccounts/privateEndpointConnections","etag":"W/\"0x8D8DEDD11986F37\"","properties":{"provisioningState":"Updating","privateEndpoint":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Network/privateEndpoints/priv_endpoint000004"},"privateLinkServiceConnectionState":{"status":"Rejected","description":"You
          are rejected!","actionsRequired":"Manual approval request"}}}
      - step: RawStep_3406
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnectionResults/Updating$priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc$d91549a8-2974-4c40-ad6c-ec7f137f1681?api-version=2020-05-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint-connection reject
          Connection: keep-alive
          ParameterSetName: '--resource-name --name --resource-group --type --description'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-batch/9.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: '{"status":"Succeeded","retryAfter":0}'
      - step: RawStep_3407
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc?api-version=2020-05-01
        requestHeaders:
          Accept: application/json
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint-connection reject
          Connection: keep-alive
          ParameterSetName: '--resource-name --name --resource-group --type --description'
          User-Agent: >-
            python/3.7.3 (Windows-10-10.0.19041-SP0) msrest/0.6.21
            msrest_azure/0.6.3 azure-mgmt-batch/9.0.0 Azure-SDK-For-Python
            AZURECLI/2.20.0
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","name":"priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","type":"Microsoft.Batch/batchAccounts/privateEndpointConnections","etag":"W/\"0x8D8DEDD11986F37\"","properties":{"provisioningState":"Succeeded","privateEndpoint":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Network/privateEndpoints/priv_endpoint000004"},"privateLinkServiceConnectionState":{"status":"Rejected","description":"You
          are rejected!","actionsRequired":"Manual approval request"}}}
      - step: RawStep_3408
        method: GET
        rawUrl: >-
          https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc?api-version=2020-05-01
        requestHeaders:
          Accept: '*/*'
          Accept-Encoding: gzip, deflate
          CommandName: network private-endpoint-connection show
          Connection: keep-alive
          ParameterSetName: '--id'
          User-Agent: python/3.7.3 (Windows-10-10.0.19041-SP0) AZURECLI/2.20.0
        responseExpected: >-
          {"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Batch/batchAccounts/testplinksbatch/privateEndpointConnections/priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","name":"priv_endpoint000004.774b5cd1-4b80-47cd-81d5-99b20dc0ffdc","type":"Microsoft.Batch/batchAccounts/privateEndpointConnections","etag":"W/\"0x8D8DEDD11986F37\"","properties":{"provisioningState":"Succeeded","privateEndpoint":{"id":"/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/clitest.rg000001/providers/Microsoft.Network/privateEndpoints/priv_endpoint000004"},"privateLinkServiceConnectionState":{"status":"Rejected","description":"You
          are rejected!","actionsRequired":"Manual approval request"}}}
      - step: PrivateEndpoints_Delete_3409
        exampleFile: ../examples/PrivateEndpoints_Delete_30_Generated.json
        operationId: PrivateEndpoints_Delete
    variables:
      virtualNetworkName: testvnet000002
      subnetName: testsubnet000003
      privateEndpointName: priv_endpoint000004
