# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-rest-api-specs/main/documentation/api-scenario/references/v1.2/schema.json
scope: ResourceGroup

variables:
  queryPackName: 
    type: string
    prefix: oiquerypack
  
prepareSteps:
- step: QueryPacks_CreateOrUpdate  ### 201??? sdk code issue??? wait swagger fix: https://github.com/Azure/azure-rest-api-specs/issues/20822
  exampleFile: ..\examples\QueryPacksCreate.json
  outputVariables:
    queryPackId:
      type: string
      fromResponse: /properties/queryPackId

scenarios:
  - scenario: QueryPack
    description: Microsoft.OperationalInsights/queryPacks
    steps:
      - step: QueryPacks_List
        exampleFile: ..\examples\QueryPacksList.json
      - step: QueryPacks_Get
        exampleFile: ..\examples\QueryPacksGet.json
      - step: QueryPacks_ListByResourceGroup
        exampleFile: ..\examples\QueryPacksListByResourceGroup.json
      - step: QueryPacks_UpdateTags
        exampleFile: ..\examples\QueryPacksUpdateTagsOnly.json

  - scenario: Query
    description: Microsoft.OperationalInsights/queryPacks/queries
    variables:
      id: $(queryPackId)
    steps:
      - step: Queries_Put
        exampleFile: ..\examples\QueryPackQueriesPut.json
        requestUpdate:
          - replace: /QueryPayload/properties/related/categories
            value: network
      - step: Queries_List
        exampleFile: ..\examples\QueryPackQueriesList.json
      - step: Queries_Get
        exampleFile: ..\examples\QueryPackQueriesGet.json
      - step: Queries_Update
        exampleFile: ..\examples\QueryPackQueriesUpdate.json
        requestUpdate:
          - replace: /QueryPayload/properties/related/categories
            value: network
      - step: Queries_Search
        exampleFile: ..\examples\QueryPackQueriesSearch.json
      - step: Queries_Delete
        exampleFile: ..\examples\QueryPackQueriesDelete.json

cleanUpSteps:
  - step: QueryPacks_Delete
    exampleFile: ..\examples\QueryPacksDelete.json